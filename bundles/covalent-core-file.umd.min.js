!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/portal"),require("@angular/material/icon"),require("@angular/material/button"),require("@angular/cdk/coercion"),require("@covalent/core/common"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@covalent/core/file",["exports","@angular/core","@angular/common","@angular/forms","@angular/cdk/portal","@angular/material/icon","@angular/material/button","@angular/cdk/coercion","@covalent/core/common","@angular/common/http","rxjs","rxjs/operators"],t):t(((e=e||self).covalent=e.covalent||{},e.covalent.core=e.covalent.core||{},e.covalent.core.file={}),e.ng.core,e.ng.common,e.ng.forms,e.ng.cdk.portal,e.ng.material.icon,e.ng.material.button,e.ng.cdk.coercion,e.covalent.core.common,e.ng.common.http,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,r,o,i,l,a,p,u,c,s){"use strict";var d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function f(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var m=function(){function e(e){this.model=e,this._multiple=!1,this.fileSelect=new t.EventEmitter}return Object.defineProperty(e.prototype,"multiple",{set:function(e){this._multiple=a.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleBinding",{get:function(){return this._multiple?"":undefined},enumerable:!0,configurable:!0}),e.prototype.onChange=function(e){if(e.target instanceof HTMLInputElement){var t=e.target.files;if(t.length){var n=this._multiple&&t.length>1?t:t[0];this.model?this.model.update.emit(n):this.fileSelect.emit(n)}}},e.decorators=[{type:t.Directive,args:[{selector:"[tdFileSelect]"}]}],e.ctorParameters=function(){return[{type:r.NgModel,decorators:[{type:t.Optional},{type:t.Host}]}]},e.propDecorators={multiple:[{type:t.Input,args:["multiple"]}],fileSelect:[{type:t.Output}],multipleBinding:[{type:t.HostBinding,args:["attr.multiple"]}],onChange:[{type:t.HostListener,args:["change",["$event"]]}]},e}(),h=function(){},g=p.mixinDisabled(h),y=function(e){function n(n,r){var o=e.call(this)||this;return o._renderer=n,o._element=r,o._multiple=!1,o.fileDrop=new t.EventEmitter,o}return f(n,e),Object.defineProperty(n.prototype,"multiple",{set:function(e){this._multiple=a.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"multipleBinding",{get:function(){return this._multiple?"":undefined},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"disabledBinding",{get:function(){return this.disabled?"":undefined},enumerable:!0,configurable:!0}),n.prototype.onDrop=function(e){if(!this.disabled){var t=e.dataTransfer.files;if(t.length){var n=this._multiple&&t.length>1?t:t[0];this.fileDrop.emit(n)}}this._renderer.removeClass(this._element.nativeElement,"drop-zone"),this._stopEvent(e)},n.prototype.onDragOver=function(e){var t=e.dataTransfer;t.dropEffect=this._typeCheck(t.types),this.disabled||!this._multiple&&(t.items&&t.items.length>1||t.mozItemCount>1)?t.dropEffect="none":t.dropEffect="copy",this._stopEvent(e)},n.prototype.onDragEnter=function(e){this.disabled||this._renderer.addClass(this._element.nativeElement,"drop-zone"),this._stopEvent(e)},n.prototype.onDragLeave=function(e){this._renderer.removeClass(this._element.nativeElement,"drop-zone"),this._stopEvent(e)},n.prototype._typeCheck=function(e){var t="none";return e&&(e.contains&&e.contains("Files")||e.indexOf&&-1!==e.indexOf("Files"))&&(t="copy"),t},n.prototype._stopEvent=function(e){e.preventDefault(),e.stopPropagation()},n.decorators=[{type:t.Directive,args:[{selector:"[tdFileDrop]",inputs:["disabled"]}]}],n.ctorParameters=function(){return[{type:t.Renderer2},{type:t.ElementRef}]},n.propDecorators={multiple:[{type:t.Input,args:["multiple"]}],fileDrop:[{type:t.Output}],multipleBinding:[{type:t.HostBinding,args:["attr.multiple"]}],disabledBinding:[{type:t.HostBinding,args:["attr.disabled"]}],onDrop:[{type:t.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:t.HostListener,args:["dragover",["$event"]]}],onDragEnter:[{type:t.HostListener,args:["dragenter",["$event"]]}],onDragLeave:[{type:t.HostListener,args:["dragleave",["$event"]]}]},n}(g),v=function(e){function n(t,n){return e.call(this,t,n)||this}return f(n,e),n.decorators=[{type:t.Directive,args:[{selector:"[td-file-input-label]ng-template"}]}],n.ctorParameters=function(){return[{type:t.TemplateRef},{type:t.ViewContainerRef}]},n}(o.TemplatePortalDirective),b=function(e){this._changeDetectorRef=e},_=p.mixinControlValueAccessor(p.mixinDisabled(b)),D=function(e){function n(n,r){var o=e.call(this,r)||this;return o._renderer=n,o._multiple=!1,o.select=new t.EventEmitter,o}return f(n,e),Object.defineProperty(n.prototype,"inputElement",{get:function(){return this._inputElement.nativeElement},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"multiple",{get:function(){return this._multiple},set:function(e){this._multiple=a.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),n.prototype.handleSelect=function(e){this.writeValue(e),this.select.emit(e)},n.prototype.clear=function(){this.writeValue(undefined),this._renderer.setProperty(this.inputElement,"value","")},n.prototype.onDisabledChange=function(e){e&&this.clear()},n.prototype.setDisabledState=function(e){this.disabled=e},n.decorators=[{type:t.Component,args:[{changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:r.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return n}),multi:!0}],selector:"td-file-input",inputs:["disabled","value"],template:'<div>\n  <button\n    mat-raised-button\n    class="td-file-input"\n    type="button"\n    [color]="color"\n    [multiple]="multiple"\n    [disabled]="disabled"\n    (keyup.enter)="fileInput.click()"\n    (click)="fileInput.click()"\n    (fileDrop)="handleSelect($event)"\n    tdFileDrop\n  >\n    <ng-content></ng-content>\n  </button>\n  <input\n    #fileInput\n    class="td-file-input-hidden"\n    type="file"\n    [attr.accept]="accept"\n    (fileSelect)="handleSelect($event)"\n    [multiple]="multiple"\n    [disabled]="disabled"\n    tdFileSelect\n  />\n</div>\n',styles:[":host .td-file-input{padding-left:8px;padding-right:8px}:host input.td-file-input-hidden{display:none}:host .drop-zone{border-radius:3px}:host .drop-zone *{pointer-events:none}"]}]}],n.ctorParameters=function(){return[{type:t.Renderer2},{type:t.ChangeDetectorRef}]},n.propDecorators={_inputElement:[{type:t.ViewChild,args:["fileInput",{"static":!0}]}],color:[{type:t.Input}],multiple:[{type:t.Input,args:["multiple"]}],accept:[{type:t.Input}],select:[{type:t.Output}]},n}(_),C=function(e){this._changeDetectorRef=e},E=p.mixinControlValueAccessor(p.mixinDisabled(C)),x=function(e){function n(n){var r=e.call(this,n)||this;return r._multiple=!1,r._required=!1,r.defaultColor="primary",r.activeColor="accent",r.cancelColor="warn",r.select=new t.EventEmitter,r.upload=new t.EventEmitter,r.cancel=new t.EventEmitter,r}return f(n,e),Object.defineProperty(n.prototype,"multiple",{get:function(){return this._multiple},set:function(e){this._multiple=a.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"required",{get:function(){return this._required},set:function(e){this._required=a.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),n.prototype.uploadPressed=function(){this.value&&this.upload.emit(this.value)},n.prototype.handleSelect=function(e){this.value=e,this.select.emit(e)},n.prototype._cancel=function(){this.value=undefined,this.cancel.emit(),this.fileInput&&this.fileInput.clear()},n.prototype.onDisabledChange=function(e){e&&this._cancel()},n.decorators=[{type:t.Component,args:[{changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:r.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return n}),multi:!0}],selector:"td-file-upload",inputs:["disabled","value"],template:'<td-file-input\n  *ngIf="!value"\n  [(ngModel)]="value"\n  [multiple]="multiple"\n  [disabled]="disabled"\n  [accept]="accept"\n  [color]="defaultColor"\n  (select)="handleSelect($event)"\n>\n  <ng-template [cdkPortalOutlet]="inputLabel" [ngIf]="true"></ng-template>\n</td-file-input>\n<div *ngIf="value">\n  <button\n    #fileUpload\n    class="td-file-upload"\n    mat-raised-button\n    type="button"\n    [color]="activeColor"\n    (keyup.delete)="_cancel()"\n    (keyup.backspace)="_cancel()"\n    (keyup.escape)="_cancel()"\n    (click)="uploadPressed()"\n  >\n    <ng-content></ng-content>\n  </button>\n  <button mat-icon-button type="button" class="td-file-upload-cancel" [color]="cancelColor" (click)="_cancel()">\n    <mat-icon>cancel</mat-icon>\n  </button>\n</div>\n',styles:[".td-file-upload{padding-left:8px;padding-right:8px}.td-file-upload-cancel{height:24px;width:24px;position:relative;top:24px;left:-12px}::ng-deep [dir=rtl] .td-file-upload-cancel{right:-12px;left:0}.td-file-upload-cancel mat-icon{border-radius:12px;vertical-align:baseline}.drop-zone{border-radius:3px}.drop-zone *{pointer-events:none}"]}]}],n.ctorParameters=function(){return[{type:t.ChangeDetectorRef}]},n.propDecorators={fileInput:[{type:t.ViewChild,args:[D,{"static":!1}]}],inputLabel:[{type:t.ContentChild,args:[v,{"static":!1}]}],defaultColor:[{type:t.Input}],activeColor:[{type:t.Input}],cancelColor:[{type:t.Input}],multiple:[{type:t.Input,args:["multiple"]}],required:[{type:t.Input,args:["required"]}],accept:[{type:t.Input}],select:[{type:t.Output}],upload:[{type:t.Output}],cancel:[{type:t.Output}]},n}(E),O=[m,y,x,D,v],P=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[r.FormsModule,n.CommonModule,i.MatIconModule,l.MatButtonModule,o.PortalModule],declarations:[O],exports:[O]}]}],e}(),I=function(){function e(e){this._http=e,this._progressSubject=new c.Subject,this._progressObservable=this._progressSubject.asObservable()}return Object.defineProperty(e.prototype,"progress",{get:function(){return this._progressObservable},enumerable:!0,configurable:!0}),e.prototype.send=function(e,t,n,r){var o=this,i=void 0===r?{}:r,l=i.headers,a=i.params;if(!this._http)throw new Error("The HttpClient module needs to be imported at root module level");var p=new u.HttpRequest(t.toUpperCase(),e,n,{reportProgress:!0,headers:new u.HttpHeaders(l||{}),params:new u.HttpParams({fromObject:a||{}})});return this._http.request(p).pipe(s.tap(function(e){return o.handleEvent(e)}))},e.prototype.upload=function(e){var t=this;return new c.Observable(function(n){var r,o,i=new XMLHttpRequest,l=new FormData;if(e.file!==undefined)l.append("file",e.file);else{if(e.formData===undefined)return n.error("For [IUploadOptions] you have to set either the [file] or the [formData] property.");l=e.formData}if(i.upload.onprogress=function(e){var n=0;e.lengthComputable&&(n=Math.round(e.loaded/e.total*100)),t._progressSubject.next(n)},i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?(n.next(i.response),n.complete()):n.error(i.response))},i.open(e.method,e.url,!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.headers)try{for(var a=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(Object.keys(e.headers)),p=a.next();!p.done;p=a.next()){var u=p.value;i.setRequestHeader(u,e.headers[u])}}catch(c){r={error:c}}finally{try{p&&!p.done&&(o=a["return"])&&o.call(a)}finally{if(r)throw r.error}}i.send(l)})},e.prototype.handleEvent=function(e){switch(e.type){case u.HttpEventType.Sent:this._progressSubject.next(0);break;case u.HttpEventType.UploadProgress:this._progressSubject.next(Math.round(100*e.loaded/e.total));break;case u.HttpEventType.Response:this._progressSubject.next(100)}},e.decorators=[{type:t.Injectable,args:[{providedIn:P}]}],e.ctorParameters=function(){return[{type:u.HttpClient,decorators:[{type:t.Optional}]}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(u.HttpClient,8))},token:e,providedIn:P}),e}();e.CovalentFileModule=P,e.TdFileDropBase=h,e.TdFileDropDirective=y,e.TdFileInputBase=b,e.TdFileInputComponent=D,e.TdFileInputLabelDirective=v,e.TdFileSelectDirective=m,e.TdFileService=I,e.TdFileUploadBase=C,e.TdFileUploadComponent=x,e._TdFileDropMixinBase=g,e._TdFileInputMixinBase=_,e._TdFileUploadMixinBase=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=covalent-core-file.umd.min.js.map